# HyperSense Trading Agent Configuration
#
# Override in config/settings.local.yml (not committed to git)
# or environment-specific files (config/settings/production.yml)

# Trading Assets
assets:
  - BTC
  - ETH
  - SOL
  - BNB

# Trading Cycle Configuration
trading:
  paper_trading: true            # Enable paper trading mode (no real orders)

# Volatility-Based Dynamic Scheduling
# Trading cycle interval adjusts based on ATR (Average True Range)
volatility:
  # ATR thresholds as percentage of price
  thresholds:
    very_high: 0.03   # >= 3% ATR = Very High volatility
    high: 0.02        # >= 2% ATR = High volatility
    medium: 0.01      # >= 1% ATR = Medium volatility (below = Low)
  # Corresponding trading cycle intervals in minutes
  intervals:
    very_high: 3      # 3 min - most frequent for volatile markets
    high: 6           # 6 min
    medium: 12        # 12 min - default
    low: 25           # 25 min - least frequent for quiet markets
  # Fallback interval when volatility cannot be determined
  default_interval: 12

# Risk Management
risk:
  max_position_size: 0.05        # Max 5% of capital per trade
  min_confidence: 0.6            # Minimum confidence score to execute
  max_leverage: 10               # Maximum leverage allowed
  default_leverage: 3            # Default leverage for new positions
  max_open_positions: 5          # Maximum concurrent positions
  # Position Sizing
  max_risk_per_trade: 0.01       # 1% of capital at risk per trade
  # Risk/Reward Validation
  min_risk_reward_ratio: 1.5     # Minimum R/R ratio (1.5:1) - lowered from 2.0 to allow more trades
  enforce_risk_reward_ratio: true # Reject trades below min R/R (false = warn only)
  # Circuit Breaker
  max_daily_loss: 0.05           # 5% max daily loss triggers circuit breaker
  max_consecutive_losses: 3      # Consecutive losses before halt
  circuit_breaker_cooldown: 24   # Hours to wait after circuit breaker trigger

# Data Readiness Requirements
# Trading is blocked unless all required data sources are available
# This prevents making decisions with incomplete context
readiness:
  require_macro_strategy: true    # Require valid macro strategy (not fallback from parse error)
  require_forecasts: true         # Require at least one asset has recent forecasts
  require_fresh_market_data: true # Require recent market snapshots for all assets
  require_sentiment: true         # Require Fear & Greed sentiment data
  market_data_max_age_minutes: 5  # Market snapshots must be newer than this
  forecast_max_age_hours: 1       # Forecasts must be newer than this

# Stop Loss / Take Profit Defaults (percentage)
defaults:
  stop_loss_pct: 0.05            # 5% stop loss
  take_profit_pct: 0.10          # 10% take profit

# Risk Profiles (parameter presets for different trading styles)
# These override base risk settings when a profile is active
risk_profiles:
  cautious:
    rsi_oversold: 35              # More selective oversold threshold
    rsi_overbought: 65            # More selective overbought threshold
    rsi_pullback_threshold: 60    # Wait for RSI below this for long entry
    rsi_bounce_threshold: 40      # Wait for RSI above this for short entry
    min_risk_reward_ratio: 2.0    # Require better R/R for trades
    min_confidence: 0.7           # Higher confidence required
    max_position_size: 0.03       # 3% max position
    default_leverage: 2           # Lower leverage
    max_open_positions: 3         # Fewer concurrent positions
    # Profit Protection Settings
    tp_zone_pct: 0.03             # 3% from TP = consider closing (take profits earlier)
    profit_drawdown_alert_pct: 0.25  # Alert if 25% of peak profit is lost
    trailing_stop:
      enabled: true
      activation_profit_pct: 0.02   # Activate at 2% profit
      trail_distance_pct: 0.015     # Trail 1.5% behind peak
  moderate:
    rsi_oversold: 30              # Standard oversold threshold
    rsi_overbought: 70            # Standard overbought threshold
    rsi_pullback_threshold: 65    # Standard pullback threshold
    rsi_bounce_threshold: 35      # Standard bounce threshold
    min_risk_reward_ratio: 1.5    # Standard R/R requirement
    min_confidence: 0.6           # Standard confidence
    max_position_size: 0.05       # 5% max position
    default_leverage: 3           # Standard leverage
    max_open_positions: 5         # Standard positions
    # Profit Protection Settings
    tp_zone_pct: 0.02             # 2% from TP = consider closing (balanced)
    profit_drawdown_alert_pct: 0.30  # Alert if 30% of peak profit is lost
    trailing_stop:
      enabled: true
      activation_profit_pct: 0.015  # Activate at 1.5% profit
      trail_distance_pct: 0.01      # Trail 1% behind peak
  fearless:
    rsi_oversold: 25              # More aggressive oversold threshold
    rsi_overbought: 75            # More aggressive overbought threshold
    rsi_pullback_threshold: 68    # Accept entries at higher RSI
    rsi_bounce_threshold: 32      # Accept entries at lower RSI
    min_risk_reward_ratio: 1.2    # Accept lower R/R trades
    min_confidence: 0.5           # Lower confidence threshold
    max_position_size: 0.08       # 8% max position
    default_leverage: 5           # Higher leverage
    max_open_positions: 7         # More concurrent positions
    # Profit Protection Settings
    tp_zone_pct: 0.015            # 1.5% from TP = consider closing (let winners run)
    profit_drawdown_alert_pct: 0.40  # Alert if 40% of peak profit is lost (more tolerance)
    trailing_stop:
      enabled: true
      activation_profit_pct: 0.02   # Activate at 2% profit
      trail_distance_pct: 0.008     # Trail 0.8% behind peak (tighter)

# Context Weights for Reasoning
# Technical indicators are the primary signal (proven, based on actual price action)
# Sentiment provides confirmation/contrarian signals
# Forecast (Prophet ML) is supplementary (not designed for volatile crypto markets)
# Whale alerts hint at smart money positioning
weights:
  technical: 0.50
  sentiment: 0.25
  forecast: 0.15
  whale_alerts: 0.10

# Macro Strategy
macro:
  refresh_interval_hours: 24     # How often to refresh macro strategy
  lookback_days: 7               # Days of data for macro analysis

# LLM Configuration (supports Anthropic, Gemini, Ollama, OpenAI)
llm:
  provider: <%= ENV.fetch('LLM_PROVIDER', 'anthropic') %>
  anthropic:
    api_key: <%= ENV.fetch('ANTHROPIC_API_KEY', '') %>
    model: <%= ENV.fetch('ANTHROPIC_MODEL', 'claude-sonnet-4-5') %>
  gemini:
    api_key: <%= ENV.fetch('GEMINI_API_KEY', '') %>
    model: <%= ENV.fetch('GEMINI_MODEL', 'gemini-2.0-flash-exp') %>
  ollama:
    api_base: <%= ENV.fetch('OLLAMA_API_BASE', 'http://localhost:11434/v1') %>
    model: <%= ENV.fetch('OLLAMA_MODEL', 'llama3') %>
  openai:
    api_key: <%= ENV.fetch('OPENAI_API_KEY', '') %>
    model: <%= ENV.fetch('OPENAI_MODEL', 'gpt-5.2') %>
  high_level:
    max_tokens: 2000
    temperature: 0.3
  low_level:
    max_tokens: 1500
    temperature: 0.2

# Hyperliquid Exchange Configuration
hyperliquid:
  testnet: false                   # Use mainnet for real market prices (paper_trading handles safety)
  mainnet_url: "https://api.hyperliquid.xyz"
  testnet_url: "https://api.hyperliquid-testnet.xyz"
  retry_attempts: 3                # Number of retry attempts for failed requests
  timeout: 30                      # Request timeout in seconds
  slippage: 0.005                  # 0.5% slippage for market orders

# API Rate Limits (requests per minute)
rate_limits:
  binance: 1200
  coingecko: 50
  fear_greed: 10
  hyperliquid: 100

# Cost Tracking Configuration
# Used for on-the-fly cost calculations and net P&L reporting
costs:
  # Trading fees (Hyperliquid)
  trading:
    taker_fee_pct: 0.000450       # 0.0450% per transaction (market orders)
    maker_fee_pct: 0.000150       # 0.0150% per transaction (limit orders)
    default_order_type: taker     # Assume taker fees for market orders

  # Server costs (monthly, in USD)
  server:
    monthly_cost: 15.00

  # LLM costs (per 1 million tokens, in USD)
  # Update these when pricing changes
  llm:
    anthropic:
      claude-sonnet-4-5:
        input_per_million: 3.00
        output_per_million: 15.00
      claude-haiku-4-5:
        input_per_million: 1.00
        output_per_million: 5.00
    gemini:
      gemini-2.0-flash-exp:
        input_per_million: 0.50
        output_per_million: 3.00
      gemini-3-flash-preview:
        input_per_million: 0.50
        output_per_million: 3.00
    ollama:
      # Ollama is free (local inference)
      default:
        input_per_million: 0.00
        output_per_million: 0.00
    openai:
      gpt-5.2:
        input_per_million: 1.75
        output_per_million: 14.00
      gpt-5-mini:
        input_per_million: 0.25
        output_per_million: 2.00
